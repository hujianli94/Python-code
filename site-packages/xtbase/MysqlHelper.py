#coding=utf8
__author__ = '9020win764z'

import sys, MySQLdb, pyenv

class XtMysql:
    def __init__(self, config=None):
        if config is None:
            config = pyenv.getMysqlConfig()
        try:
            self.conn = MySQLdb.connect(host = config["host"],
                user = config["user"],
                passwd = config["passwd"],
                db = config["db"],
                port = config["port"],
                charset = 'utf8')
            self.m_cursor = self.conn.cursor(MySQLdb.cursors.DictCursor)
        except MySQLdb.Error, e:
            print "Error %d: %s" % (e.args[0], e.args[1])
            sys.exit(1)

    def getConn(self):
        return self.conn

    def execQuery(self, strSql):
        datas = []
        try:
            if isinstance(strSql, unicode):
                strSql = strSql.encode('utf-8')
            self.m_cursor.execute(strSql)
            datas = self.m_cursor.fetchall()
        except MySQLdb.Error, e:
            print strSql
            print "Error %d: %s" % (e.args[0], e.args[1])
        return datas

    def execCommand(self, strSql):
        try:
            if isinstance(strSql, unicode):
                strSql = strSql.encode('utf-8')
            self.m_cursor.execute(strSql)
        except MySQLdb.Error, e:
            print strSql
            print "Error %d: %s" % (e.args[0], e.args[1])

    def commit(self):
        self.conn.commit()